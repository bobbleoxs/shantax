<!DOCTYPE html>
<html lang="en-gb">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Building a Withholding Tax Determination Engine | Shan Sun</title>
  <meta name="description" content="Reflections on tax, tax technology and more.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Building a Withholding Tax Determination Engine" />
<meta property="og:description" content="I. What is withholding tax? Withholding tax (&ldquo;WHT&rdquo;) refers to an amount of tax withheld at source at a certain rate determined by local tax law. The most common example is payroll taxes withheld and paid by employers on employee wages. Withholding taxes also apply where sellers and buyers are situated in different jurisdictions, with rates varying by country or due to specific double tax treaties between tax authorities.
WHT can be applied to different types of remuneration, such as dividend, interest, royalty, commission, fees, and rentals, as well as transactions, i." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shan.tax/posts/buildingawithholdingtaxdeterminationengine/" />
<meta property="article:published_time" content="2021-06-21T23:00:00+00:00" />
<meta property="article:modified_time" content="2021-06-21T23:00:00+00:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Building a Withholding Tax Determination Engine"/>
<meta name="twitter:description" content="I. What is withholding tax? Withholding tax (&ldquo;WHT&rdquo;) refers to an amount of tax withheld at source at a certain rate determined by local tax law. The most common example is payroll taxes withheld and paid by employers on employee wages. Withholding taxes also apply where sellers and buyers are situated in different jurisdictions, with rates varying by country or due to specific double tax treaties between tax authorities.
WHT can be applied to different types of remuneration, such as dividend, interest, royalty, commission, fees, and rentals, as well as transactions, i."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://shan.tax/css/style-white.css">
  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://shan.tax/images/favicon.ico" />

  
  
  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/about/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://shan.tax/posts/buildinganhscodeclassification/">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://shan.tax/about/">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&text=Building%20a%20Withholding%20Tax%20Determination%20Engine">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&title=Building%20a%20Withholding%20Tax%20Determination%20Engine">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&is_video=false&description=Building%20a%20Withholding%20Tax%20Determination%20Engine">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Building%20a%20Withholding%20Tax%20Determination%20Engine&body=Check out this article: https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&title=Building%20a%20Withholding%20Tax%20Determination%20Engine">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&title=Building%20a%20Withholding%20Tax%20Determination%20Engine">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&title=Building%20a%20Withholding%20Tax%20Determination%20Engine">
      <i class="fab fa-stumbleupon " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://digg.com/submit?url=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&title=Building%20a%20Withholding%20Tax%20Determination%20Engine">
      <i class="fab fa-digg " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&name=Building%20a%20Withholding%20Tax%20Determination%20Engine&description=I.%20What%20is%20withholding%20tax%3f%20Withholding%20tax%20%28%26ldquo%3bWHT%26rdquo%3b%29%20refers%20to%20an%20amount%20of%20tax%20withheld%20at%20source%20at%20a%20certain%20rate%20determined%20by%20local%20tax%20law.%20The%20most%20common%20example%20is%20payroll%20taxes%20withheld%20and%20paid%20by%20employers%20on%20employee%20wages.%20Withholding%20taxes%20also%20apply%20where%20sellers%20and%20buyers%20are%20situated%20in%20different%20jurisdictions%2c%20with%20rates%20varying%20by%20country%20or%20due%20to%20specific%20double%20tax%20treaties%20between%20tax%20authorities.%0aWHT%20can%20be%20applied%20to%20different%20types%20of%20remuneration%2c%20such%20as%20dividend%2c%20interest%2c%20royalty%2c%20commission%2c%20fees%2c%20and%20rentals%2c%20as%20well%20as%20transactions%2c%20i.">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&t=Building%20a%20Withholding%20Tax%20Determination%20Engine">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#i-what-is-withholding-tax"><strong>I. What is withholding tax?</strong></a></li>
        <li><a href="#ii-withholding-tax-challenges"><strong>II. Withholding tax challenges</strong></a></li>
        <li><a href="#iii-building-a-withholding-tax-engine"><strong>III. Building a withholding tax engine</strong></a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Building a Withholding Tax Determination Engine
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2021-06-21 23:00:00 &#43;0000 UTC" itemprop="datePublished">2021-06</time>
          
        </div>
        
        
      </div>
    </header>

  
    <div class="content" itemprop="articleBody">
      <h3 id="i-what-is-withholding-tax"><strong>I. What is withholding tax?</strong></h3>
<p>Withholding tax (&ldquo;WHT&rdquo;) refers to an amount of tax withheld at source at a certain rate determined by local tax law. The most common example is payroll taxes withheld and paid by employers on employee wages. Withholding taxes also apply where sellers and buyers are situated in different jurisdictions, with rates varying by country or due to specific double tax treaties between tax authorities.</p>
<p>WHT can be applied to different types of remuneration, such as dividend, interest, royalty, commission, fees, and rentals, as well as transactions, i.e. digital transactions. The recipient (payee) could be employees, business partners, and overseas entities.</p>
<blockquote>
<p>WHT is not the same as VAT or other forms of indirect taxes. In some countries, VAT charged by a provider has to be withheld by the payer and paid to the tax authorities, but this is not a WHT.</p>
</blockquote>
<p>WHT includes both domestic withholding tax (in-country or locally) and international withholding, subject to local tax law or double tax treaties.</p>
<h3 id="ii-withholding-tax-challenges"><strong>II. Withholding tax challenges</strong></h3>
<p>Like many other taxes, withholding tax data can be collected via a mixture of online and offline sources. From the account payable (AP) side, companies often receive invoices, include them in the ERP system with relevant accounting treatments, leaving withholding tax as an afterthought.</p>
<p>A solution to these problems is to build a “withholding tax engine” which can automatically determine the correct WHT rate, tailored to the nature of each transaction based on tax law, and calculate the corresponding WHT amount. Major challenges encountered in building a withholding tax engine include:</p>
<ul>
<li><strong>Fragmented data sources</strong> - where sales/purchase data was detached from withholding tax posting and added on afterward.</li>
<li><strong>Missing data</strong> - invoices come in different forms and types, sometimes handwritten. There are inevitably missing fields that may otherwise be valuable information in determining the correct withholding tax rate.</li>
<li><strong>Mismatched or inconsistent data</strong> - given the variety of invoices, the information is often inconsistent, resulting in bad quality data; this requires numerous edge cases to be accounted for.</li>
<li><strong>Small data size</strong> - despite being a transaction-level tax, there is limited data that is complete, accurate, and consistent; this means supervised learning models utilizing natural language processing techniques are less appropriate. Unsupervised learning is therefore a more appropriate method to explore first.</li>
<li><strong>Significant differences in country rules</strong> - unlike VAT or GST, countries don&rsquo;t always have the same tax base for withholding taxes. It’s a spider web of rules which requires considerations on a country-by-country basis.</li>
<li><strong>Double tax treaties</strong> - other than the differences in underlying country rules, each country may have also negotiated different treaty agreements on withholding tax rates for each tax category (e.g. royalties, dividend, interest), adding further complexities.</li>
</ul>
<h3 id="iii-building-a-withholding-tax-engine"><strong>III. Building a withholding tax engine</strong></h3>
<p>The building work was split into a 5-step process:</p>
<ol>
<li><strong>Check and sort the data available</strong> on Sales Invoices (SI), Good Receipts (GR), and Purchase Order (PO) for one country only as a prototype;</li>
<li><strong>Review the rules per country</strong>. Each country would have negotiated separate tax treaties, so it makes sense to train separate models for the determination engine for each country;</li>
<li><strong>Hard code rules where possible. Determining WHT can be done in part using logical hard-coded rules arising from my review of each country’s tax treaties.</strong></li>
<li><strong>Use trained machine learning models to refine the result</strong>. Applying language modelling and unsupervised learning to make data-backed judgments based on invoice descriptions;</li>
<li><strong>Build a UI</strong> to host the engine to allow users to interact with the determination engine.</li>
</ol>
<p>After a successful build of the prototype, the next step is to iterate and refine the models based on user feedback and explore the possibility of scaling the prototype to other countries. This implementation process would be worthy of a separate blog post.</p>

    </div>
  </article>

  
  





  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#i-what-is-withholding-tax"><strong>I. What is withholding tax?</strong></a></li>
        <li><a href="#ii-withholding-tax-challenges"><strong>II. Withholding tax challenges</strong></a></li>
        <li><a href="#iii-building-a-withholding-tax-engine"><strong>III. Building a withholding tax engine</strong></a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&text=Building%20a%20Withholding%20Tax%20Determination%20Engine">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&title=Building%20a%20Withholding%20Tax%20Determination%20Engine">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&is_video=false&description=Building%20a%20Withholding%20Tax%20Determination%20Engine">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Building%20a%20Withholding%20Tax%20Determination%20Engine&body=Check out this article: https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&title=Building%20a%20Withholding%20Tax%20Determination%20Engine">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&title=Building%20a%20Withholding%20Tax%20Determination%20Engine">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&title=Building%20a%20Withholding%20Tax%20Determination%20Engine">
      <i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://digg.com/submit?url=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&title=Building%20a%20Withholding%20Tax%20Determination%20Engine">
      <i class="fab fa-digg fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&name=Building%20a%20Withholding%20Tax%20Determination%20Engine&description=I.%20What%20is%20withholding%20tax%3f%20Withholding%20tax%20%28%26ldquo%3bWHT%26rdquo%3b%29%20refers%20to%20an%20amount%20of%20tax%20withheld%20at%20source%20at%20a%20certain%20rate%20determined%20by%20local%20tax%20law.%20The%20most%20common%20example%20is%20payroll%20taxes%20withheld%20and%20paid%20by%20employers%20on%20employee%20wages.%20Withholding%20taxes%20also%20apply%20where%20sellers%20and%20buyers%20are%20situated%20in%20different%20jurisdictions%2c%20with%20rates%20varying%20by%20country%20or%20due%20to%20specific%20double%20tax%20treaties%20between%20tax%20authorities.%0aWHT%20can%20be%20applied%20to%20different%20types%20of%20remuneration%2c%20such%20as%20dividend%2c%20interest%2c%20royalty%2c%20commission%2c%20fees%2c%20and%20rentals%2c%20as%20well%20as%20transactions%2c%20i.">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fshan.tax%2fposts%2fbuildingawithholdingtaxdeterminationengine%2f&t=Building%20a%20Withholding%20Tax%20Determination%20Engine">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2023  Shan Sun 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/about/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>



</html>
